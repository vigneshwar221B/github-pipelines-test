- name: Set Up Terraform Workspace for secondary region
        uses: sorenson-eng/shared-github-actions/create-tf-cloud-workspace@main
        with:
          apiToken: ${{ secrets.TF_API_TOKEN }}
          teamID: team-9oiEbg9n7LRqH8ch
          terraformWorkspaceName: ${{ github.event.repository.name }}-qa-secondary-region
          tfVarSet: varset-f2C3DJRZHGfvpwdR
      - name: Terraform Init on secondary region
        id: init_secondary_region
        run: terraform init
      - name: Terraform Plan on secondary region
        id: plan_secondary_region
        run: terraform plan -var-file=qa-secondary.tfvars
        env:
          TF_VAR_aws_account_id: '${{ vars.QA_AWS_ACCOUNT_ID}}'
          TF_VAR_cognito_username: ${{ secrets.COGNITO_SERVICE_ACCOUNT_USERNAME}}
          TF_VAR_cognito_password: ${{ secrets.COGNITO_SERVICE_ACCOUNT_PASSWORD}}
      - name: Terraform Apply on secondary region
        id: apply_secondary_region
        run: terraform apply -var-file=qa-secondary.tfvars --auto-approve
        env:
          TF_VAR_aws_account_id: '${{ vars.QA_AWS_ACCOUNT_ID}}'
          TF_VAR_cognito_username: ${{ secrets.COGNITO_SERVICE_ACCOUNT_USERNAME}}
          TF_VAR_cognito_password: ${{ secrets.COGNITO_SERVICE_ACCOUNT_PASSWORD}}
      - name: Collect Terraform Outputs for secondary region
        id: tf_output_secondary_region
        run: |
          echo "secondary_region_url=$(terraform output --raw custom_domain_url)" >> $GITHUB_OUTPUT
          echo "hosted_zone_id=$(terraform output --raw hosted_zone_id)" >> $GITHUB_OUTPUT
          echo "domain_name=$(terraform output --raw domain_name)" >> $GITHUB_OUTPUT
          echo "environment=$(terraform output --raw environment)" >> $GITHUB_OUTPUT
          echo "us_west_2_synthetic_health_check_id=$(terraform output --raw synthetic_health_check_id)" >> $GITHUB_OUTPUT